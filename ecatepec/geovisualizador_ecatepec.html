<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Contralorías del Agua</title>
<link rel="stylesheet" href="styles_ecatepec.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
<script src="leaflet-plugins-1.9.3\layer\tile\Google.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<style>
  #mapa {
    height: 600px;
    width: 100%;
  }
</style>
</head>
<body>
<div class="encabezado">
  <h1>Contraloría del Agua: Ecatepec</h1>
</div>
<div class="menu">
  <a href="https://aguamap.github.io/contraloriaEcatepec/index.html">Inicio</a>
  <a href="contraloria_ecatepec.html">Ecatepec</a>
  <a href="infraestructura_ecatepec.html">Infraestructura</a>
  <a href="zonificacion_ecatepec.html">Zonificación</a>
  <a href="geovisualizador_ecatepec.html" class="active">Geovisualizador</a>
  <a href="blog_ecatepec.html">Blog</a>
  <a href="https://reporteciudadano_caem.edomex.gob.mx:8096/" target="_blank">Reporte Ciudadano</a>
</div>

<div id="mapa"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Crear el mapa
    var map = L.map('mapa').setView([19.609723, -99.060042], 12); // Coordenadas centrales de Ecatepec con zoom inicial

    // Añadir capa base de OpenStreetMap
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);
    
    var ggl = new L.Google(SATELLITE);
    
    // Función para ajustar los límites del mapa
    function getBounds(geojson) {
      var bounds = [];
      geojson.features.forEach(function(feature) {
        feature.geometry.coordinates[0][0].forEach(function(coord) {
          bounds.push([coord[1], coord[0]]);
        });
      });
      return bounds;
    }

    // Añadir capa GeoJSON
    fetch('mun_ecatepec.geojson')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        var geojsonLayer = L.geoJson(data, {
          style: {
            color: '#0000ff', // Orilla azul
            weight: 2,
            opacity: 1,
            fillColor: '#0000ff', // Sin relleno
            fillOpacity: 0 // Transparencia 100%
          }
        }).addTo(map);

        // Ajustar los límites del mapa para que no se pueda hacer zoom out más allá del municipio
        var bounds = getBounds(data);
        map.setMaxBounds(bounds);
        map.fitBounds(bounds);
        
        var baseMaps = {
          "OpenStreetMap": osm,
          "Google Satellite": ggl,
        };
        
        // Añadir control de capas
        var overlayMaps = {
          "Ecatepec": geojsonLayer
        };
        L.control.layers(null, overlayMaps).addTo(map);
      })
      .catch(error => console.error('Error al cargar el archivo GeoJSON:', error));
  });
</script>
  
</body>
</html>
